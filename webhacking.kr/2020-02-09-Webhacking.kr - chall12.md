# 문제

- 난독화된 자바스크립트 코드가 존재한다.

  ```js
  양이 너무 많아 복사 안할랜다..
  ```

  

  

# 풀이

- beautiful javascript로 정리하자

- 자바스크립트 난독화 종류를 찾아보자

  - 생성자 난독화(jjencode)다
    - 이상한 기호로 되있다는 점
    - 키 값을 매칭하는 딕셔너리로 혼동을 주는 포인트가 있다는 점

- 마지막에 constructor을 이용하여 최종 함수코드를 호출해주는 부분을

  console.log로 감싸서 출력하면 함수 코드가 보인다.

  - 근데 바로  flag를 안알려주네?

  - URL을 검사하여 특정 값이면 solve 페이지로 이동한다.

  - 해당 값으로 변경해주면 끝

    



# 알게된 것

### 자바스크립트 난독화(Obfuscation)

- 자바스크립트는 클라이언트 동작언어이기 때문에 난독화가 필요했다.
- 종류
  - [Argos 블로그](https://4rgos.tistory.com/2)
  - 대부분 문자열을 난독화시키고 document.write로 코드작성하는 기법이다.
  - 마지막 생성자 난독화가 위의 문제와 관련있어 보인다.

### 생성자 난독화

- jjencode라고 일본인이 만든거란다.

- 기호만 사용하여 자바스크립트 코드를 만드는 것이다.

- 몇가지 샘플

  `$=~[];`

  - 자바스크립트는 $, _를 변수명으로 사용가능(맨앞, 단독 모두 가능)
  - []는 빈 배열오브젝트(0x0)이지만, 앞에 연산자가 붙으면 숫자로 변환된다.
    - `~` 는 자바스크립트 tilde 연산자로
    - 보수를 취한다
    - 따라서 0의 보수인  0xff, 즉 `-1`이 $에 저장된다.

  `$$$$:(![]+"")[++$]`

  - !는 반대 논리값을 출력해주는 연산자이다.
  - !빈배열오브젝트(true) = false이다.
  - +"" 는 false를 문자열로 만들어준다.
    - 여기서 +는 문자열을 합쳐주는 기능같다.
    - alert("123"+ 123) 같은거
  - 저장되는 값은 "false"[0] = `'f'` 이다
  - 이런식으로 원하는 문자를 가져오는걸 몽타주 문자라 한단다.

  `$_$$:({}+"")[(++$)+1]`

  - {}는 +""연산에 의해 `"[object Object]"`라는 저장가능한 내장문자열로 치환된다.
  - $는 0이므로 인덱스 2의 값을 접근하므로
  - 저장되는 값은 `'b'` 이다

  ---

  ##### 엔진

  ```js
  $.$$="return"
  $.$=(0)["constructor"]["constructor"];
  ```

  - 위의 변수를 이용하여 원하는 함수를 호출한다.

    `$.$($.$($.$$+"\""+$.$_$_+(![]+"")[$._$_]+$.$$$_+"\\"+$.__$+$.$$_+$._$_+$.__+"(\\\""+$.$_$_+"\\\");"+"\"")())();`

    - 위 표현은 아래와 같다.

      ```js
      $.$($.$(return"ale\162t(\"a\");")())();
      ```

      *`(0)["constructor"]["constructor"](함수내용)`

      을 작성하면 해당 내용이 실행된다.

      *constructor를 두번 연속 호출하면 "return alert()"처럼 문자열로

      원하는 함수를 호출할 수 있다.

- [참조 - 잘 정리된 블로그글](http://www.hakawati.co.kr/226#recentComments)